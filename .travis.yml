language: common-lisp
sudo: required

env:
  matrix:
    - LISP=sbcl

install:
  # Install cl-travis
  - curl https://raw.githubusercontent.com/luismbo/cl-travis/master/install.sh | bash
  - sudo apt-get install buildapp

script:
  # - make build
  # - cl -l teller-executable -e '(asdf:make :teller-executable)'
  - sbcl --no-userinit --no-sysinit --non-interactive
    --load ~/quicklisp/setup.lisp
    --eval '(ql:quickload "teller-executable")'
    --eval '(ql:write-asdf-manifest-file "quicklisp-manifest.txt")'
  - buildapp
    --manifest-file quicklisp-manifest.txt
    --output teller
    --entry teller:tell
    --load-system teller-executable
  - pwd
  - ls -alh

deploy:
  provider: releases
  api_key: $GITHUB_TOKEN
  file: "dist/teller"
  skip_cleanup: true
  on:
    tags: true

    # --load-system teller-executable

    # --eval '(ql:quickload :teller-executable)'
